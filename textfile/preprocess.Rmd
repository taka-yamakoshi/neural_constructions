---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
```

```{r}
pairs = read_csv('./verblists.csv') %>%
  rowwise() %>%
  mutate(subject = ifelse(grepl("her", def_1) | grepl("her", def_2),
                          'She', sample(c('She', 'He')))) %>%
  select(-`extra theme`, -POSSESSIVE, -`plural recipent`,-notes)
```

```{r}
recipient_pronouns <- c('her', 'him')
recipient_nouns <- c('man', 'woman')
definites <- recipient_nouns %>% map_chr(~paste0('the ', .x))
indefinites <- recipient_nouns %>% map_chr(~paste0('a ', .x))

definite_lengtheners <- c('from work', 'wearing the hat') %>%
  map_chr(~paste0('who was ', .x)) %>%
  c('from work', 'wearing the hat')

indefinite_lengtheners <- c('from work', 'wearing a hat') %>%
  map_chr(~paste0('who was ', .x)) %>%
   c('from work', 'wearing a hat') 

longdefinites <- cross2(definites, definite_lengtheners) %>% 
  map_chr(paste, collapse = " ")

longindefinites <- cross2(indefinites, indefinite_lengtheners) %>% 
  map_chr(paste, collapse = " ")
```

Put all recipients together

```{r}                         
recipients <- bind_rows(
  data.frame(recipient = recipient_pronouns, 
             recipient_id = rep('pronoun', length(recipient_pronouns))),
  data.frame(recipient = definites, 
             recipient_id = rep('shortDefinite', length(definites))),
  data.frame(recipient = indefinites, 
             recipient_id = rep('shortIndefinite', length(indefinites))),
  data.frame(recipient = longdefinites, 
             recipient_id = rep('longDefinite', length(longdefinites))),
  data.frame(recipient = longindefinites, 
             recipient_id = rep('longIndefinite', length(longindefinites)))
)

out <- pairs %>% 
  gather(themetype, theme, def_1,def_2,indef_3,indef_4,something_5) %>%
  separate(themetype, into=c('theme_type', 'theme_id'), remove = T) %>%
  # remove slightly confusing 'she gave her' and 'he gave him' sentences
  merge(recipients) %>%
  filter(!(subject == 'She' & recipient == 'her')) %>%
  filter(!(subject == 'He' & recipient == 'him')) %>%
  unite(DOsentence, subject, verb, recipient, theme, sep = ' ', remove = F) %>%
  mutate(to = 'to') %>%
  unite(PDsentence, subject, verb, theme, to, recipient, sep = ' ', remove = T) %>% 
  group_by(verb_id,theme_id,recipient_id) %>%
  sample_n(1)

write_csv(out, './generated_pairs.csv')
```
